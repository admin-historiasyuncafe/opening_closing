<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Historias y un caf√© - Registro</title>
    
    <link rel="icon" type="image/png" href="sello_historias_y_un_cafe_01a.png">

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f7f3e8; color: #4a3b32; padding: 15px; margin: 0; }
        .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(111, 78, 55, 0.15); border-top: 5px solid #6f4e37; }
        
        /* ESTILOS PARA EL LOGO */
        .logo-header {
            text-align: center;
            margin-bottom: 25px;
        }
        .logo-header img {
            max-width: 100%; /* Se ajusta al ancho del contenedor */
            height: auto;    /* Mantiene la proporci√≥n correcta */
            max-height: 150px; /* Evita que sea excesivamente alto en pantallas grandes */
            display: inline-block;
        }

        label.input-label { display: block; margin-bottom: 8px; font-weight: bold; color: #6f4e37; }
        input[type="text"], select, textarea { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 16px; background-color: #fff; }
        
        /* Estilos para la lista de tareas */
        .task-container { background: #fafafa; padding: 15px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 20px; max-height: 50vh; overflow-y: auto; }
        .checkbox-group { display: flex; align-items: flex-start; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #eee; }
        .checkbox-group:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0;}
        .checkbox-group input { width: 22px; height: 22px; margin-right: 15px; accent-color: #6f4e37; cursor: pointer; margin-top: 2px; }
        .checkbox-group label { cursor: pointer; line-height: 1.4; font-size: 16px; flex: 1; color: #333; }
        
        button { width: 100%; padding: 15px; background: #6f4e37; color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #5a3e2b; }
        
        .hidden { display: none; }
        #loading { text-align: center; display: none; color: #6f4e37; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="logo-header">
        <img src="logo_historias_y_un_cafe_01.png" alt="Logo Historias y un caf√©">
    </div>

    <form name="submit-to-google-sheet" id="appForm">
        
        <label class="input-label">Realizado por:</label>
        <select name="Realizado_por" required>
            <option value="" disabled selected>-- Selecciona Persona --</option>
            <option value="Valeria">Valeria</option>
            <option value="Kiaraliz">Kiaraliz</option>
            <option value="Ver√≥nica">Ver√≥nica</option>
        </select>

        <label class="input-label">Selecciona el Turno</label>
        <select name="Turno" id="shiftSelector" required onchange="updateTasks()">
            <option value="" disabled selected>-- Elige una opci√≥n --</option>
            <option value="Opening">Opening ‚òÄÔ∏è</option>
            <option value="Closing">Closing üåô</option>
        </select>

        <div id="tasksArea" class="hidden">
            <label class="input-label">Marca las tareas realizadas:</label>
            <div id="taskList" class="task-container">
                </div>
        </div>

        <input type="hidden" name="Tareas_Completadas" id="hiddenTasksInput">

        <label class="input-label">Comentarios o Incidencias</label>
        <textarea name="Comentarios" rows="3" placeholder="¬øAlgo roto? ¬øFalt√≥ algo?"></textarea>

        <label class="input-label">Supervisado por:</label>
        <select name="Supervisado_por" required>
            <option value="" disabled selected>-- Selecciona Supervisor --</option>
            <option value="Valeria">Valeria</option>
            <option value="Kiaraliz">Kiaraliz</option>
            <option value="Aida">Aida</option>
            <option value="Jos√©">Jos√©</option>
        </select>

        <button type="submit" id="submitBtn">Registrar Turno</button>
        <p id="loading">Enviando datos... ‚òï</p>
    </form>
</div>

<script>
    // --- TUS LISTAS DE TAREAS ---
    const openingTasks = [
        "Prender luces", "Verificar petty", "Verificar que Doordash est√© conectado", "Llenar envases para cubiertos sucios", 
        "Acomodar pastries", "Tomar temperaturas", "Abrir puerta de almac√©n", "Organizar pa√±os", "Verificar ba√±os", 
        "Verificar piso de los salones", "Rellenar salsas", "Hacer pruebas de impresoras", "Prender m√∫sica", 
        "Subir cortina Sal√≥n 2", "Cambiar temperaturas de A/C's a 69¬∫", "Sacar bancos", "Prender abanico de puerta", 
        "Sacar HOLSTERS", "Prender open sign", "Desconectar celulares y tabletas", "Windex a puerta"
    ];

    const closingTasks = [
        "Salon 1 - Cajas", "Salon 1 - Piso", "Salon 2 - Cajas", "Salon 2 - piso", 
        "Limpiar ba√±os - CLIENTES (Jue/Dom degreaser)", "Limpiar ba√±os - EQUIPO (Jue/Dom degreaser)", 
        "Rellenar neveras", "Rellenar gavetas", "Temperaturas", "Empanadas - Notificar a cocina", 
        "Guardar postres", "Sacar basuras", "Jueves y domingo barrer y mapear almac√©n", 
        "Rellenar ketchups y syrups", "Acomodar cojines y cubiertos", "Windex a puerta", 
        "Entrar los bancos", "Cambiar temperaturas de A/C's a 74¬∫", "Limpiar mesa de platos sucios", 
        "Limpiar pa√±os y tenderlos", "Apagar m√∫sica", "Apagar OPEN sign", "Cerrar puerta de almac√©n", 
        "Cuadre de caja", "Asegurarse que todas las neveras est√©n cerradas", 
        "Asegurarse que todo equipo de limpieza se haya guardado", "Apagar todas las luces", 
        "Cargar los tel√©fonos de ser necesario", "Bajar cortina Sal√≥n 2", "Limpiar mesa Host", 
        "Verificar cheques firmados", "Rellenar salsas", "Limpiar pared de madera Sal√≥n 1"
    ];

    // --- L√ìGICA DE LA APP ---
    function updateTasks() {
        const shift = document.getElementById('shiftSelector').value;
        const taskListDiv = document.getElementById('taskList');
        const tasksArea = document.getElementById('tasksArea');
        
        taskListDiv.innerHTML = ""; 
        let currentTasks = [];

        if (shift === 'Opening') {
            currentTasks = openingTasks;
            tasksArea.classList.remove('hidden');
        } else if (shift === 'Closing') {
            currentTasks = closingTasks;
            tasksArea.classList.remove('hidden');
        } else {
            tasksArea.classList.add('hidden');
            return;
        }

        currentTasks.forEach(task => {
            const div = document.createElement('div');
            div.className = 'checkbox-group';
            div.innerHTML = `
                <input type="checkbox" value="${task}" name="task_item">
                <label>${task}</label>
            `;
            // Permite marcar el checkbox haciendo clic en el texto
            div.querySelector('label').addEventListener('click', function() {
                const cb = this.previousElementSibling;
                cb.checked = !cb.checked;
            });
            taskListDiv.appendChild(div);
        });
    }

    // --- ENV√çO A GOOGLE SHEETS ---
    
    // ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è ¬°IMPORTANTE! PEGA TU URL DE APPS SCRIPT AQU√ç ABAJO ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwA-_Aiq5jnR0ocF4j6_Zsqc4_7ByISVBewtuWGXCULJi-UlKkE2QIqXEUdKEffwYt5/exec'; 
    // ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

    const form = document.forms['submit-to-google-sheet'];
    const loadingText = document.getElementById('loading');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', e => {
        e.preventDefault();
        
        // Recopilar checkboxes marcados
        const checkboxes = document.querySelectorAll('input[name="task_item"]:checked');
        let values = [];
        checkboxes.forEach((checkbox) => {
            values.push(checkbox.value);
        });
        
        document.getElementById('hiddenTasksInput').value = values.join(', ');

        // UI de carga
        loadingText.style.display = 'block';
        submitBtn.disabled = true;
        submitBtn.innerText = "Enviando...";

        // Enviar
        fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => {
                // Resetear formulario si fue exitoso
                alert("¬°Gracias! Turno registrado exitosamente. ‚òï‚úÖ");
                form.reset();
                document.getElementById('tasksArea').classList.add('hidden');
                loadingText.style.display = 'none';
                submitBtn.disabled = false;
                submitBtn.innerText = "Registrar Turno";
            })
            .catch(error => {
                // Manejo de errores
                console.error('Error!', error.message);
                alert("‚ö†Ô∏è Hubo un error al intentar guardar. \n\nPor favor revisa tu conexi√≥n a internet e int√©ntalo de nuevo.");
                loadingText.style.display = 'none';
                submitBtn.disabled = false;
                submitBtn.innerText = "Registrar Turno";
            });
    });
</script>

</body>
</html>
